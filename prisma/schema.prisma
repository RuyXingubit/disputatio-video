generator client {
  provider   = "prisma-client-js"
  engineType = "binary"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Isp {
  id                  String   @id @default(uuid())
  name                String
  slug                String   @unique
  cnpj                String
  city                String
  state               String
  ipv4                String
  ipv6                String?
  diskOfferedGb       Int
  techName            String
  techEmail           String
  techWhatsapp        String
  ispToken            String   @unique @default(uuid())
  minioAccessKey      String   @default("")
  minioSecretKey      String   @default("")
  isActive            Boolean  @default(false)
  weight              Int      @default(100)
  healthStatus        String   @default("unknown")
  diskUsedGb          Float?
  diskTotalGb         Float?
  bandwidthOutTodayGb Float    @default(0)
  latitude            Float?
  longitude           Float?
  lastHealthCheck     DateTime?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  videoLocations VideoLocation[]

  @@map("isps")
}

model VideoLocation {
  videoId      String
  ispId        String
  isp          Isp      @relation(fields: [ispId], references: [id], onDelete: Cascade)
  isPrimary    Boolean  @default(false)
  replicatedAt DateTime @default(now())

  @@id([videoId, ispId])
  @@index([videoId])
  @@index([ispId])
  @@map("video_locations")
}

model ReplicationConfig {
  key   String @id
  value String

  @@map("replication_config")
}
